jn.define("stafftrack/check-in",((t,e,s)=>{const{Loc:i}=t("loc");const{Type:n}=t("type");const{Color:o,Indent:a}=t("tokens");const{H3:r}=t("ui-system/typography/heading");const{IconView:h,Icon:d}=t("ui-system/blocks/icon");const{Area:l}=t("ui-system/layout/area");const{Box:u}=t("ui-system/layout/box");const{ChipButton:c,ChipButtonDesign:g,ChipButtonMode:f}=t("ui-system/blocks/chips/chip-button");const{Skeleton:p}=t("stafftrack/check-in/skeleton");const{CheckInPage:y}=t("stafftrack/check-in/pages/check-in");const{SettingsPage:b}=t("stafftrack/check-in/pages/settings");const{HeightManager:M}=t("stafftrack/check-in/height-manager");const{MoreMenu:k}=t("stafftrack/check-in/more-menu");const{StatisticsMenu:m}=t("stafftrack/check-in/statistics-menu");const{ContinueButton:S}=t("stafftrack/check-in/continue-button");const{DateHelper:H}=t("stafftrack/date-helper");const{ShiftManager:I}=t("stafftrack/data-managers/shift-manager");const{SettingsManager:C}=t("stafftrack/data-managers/settings-manager");const{ShiftModel:w}=t("stafftrack/model/shift");const{MuteEnum:B}=t("stafftrack/model/counter");const{Analytics:W,CheckinOpenEnum:K,HelpdeskEnum:E}=t("stafftrack/analytics");const{ShiftAjax:A}=t("stafftrack/ajax");const{PureComponent:N}=t("layout/pure-component");class T extends N{constructor(t){super(t);this.layoutWidget=this.props.layoutWidget||PageManager;this.heightManager=new M(this.layoutWidget);this.state={loading:true,enabledBySettings:true,shift:null,dialogInfo:{dialogName:this.props.dialogName,dialogId:this.props.dialogId},options:null,userInfo:null,diskFolderId:null,counter:null};this.onKeyboardWillShowHandler=this.onKeyboardWillShowHandler.bind(this);this.onKeyboardWillHideHandler=this.onKeyboardWillHideHandler.bind(this);this.closeLayoutWidget=this.closeLayoutWidget.bind(this);this.showMoreMenu=this.showMoreMenu.bind(this);this.showStatisticsMenu=this.showStatisticsMenu.bind(this);this.openHelp=this.openHelp.bind(this);this.load=this.load.bind(this);this.statisticsMenu=null;this.moreMenu=null;this.refs={checkIn:null,settings:null,statisticsMenu:null,moreMenu:null,continueButton:null};W.sendCheckinOpen(t.dialogId?K.CHAT:K.AVA_MENU)}get user(){return this.state.userInfo??{}}get options(){return this.state.options??{}}get dialogInfo(){return this.state.dialogInfo??{}}get shift(){return this.state.shift??{}}isCounterMuted(){return this.state.counter?.muteStatus!==B.DISABLED.toNumber()}componentDidMount(){this.bindEvents();void this.load()}componentWillUnmount(){this.unbindEvents()}bindEvents(){Keyboard.on(Keyboard.Event.WillShow,this.onKeyboardWillShowHandler);Keyboard.on(Keyboard.Event.WillHide,this.onKeyboardWillHideHandler);C.on("updated",this.load)}unbindEvents(){Keyboard.off(Keyboard.Event.WillShow,this.onKeyboardWillShowHandler);Keyboard.off(Keyboard.Event.WillHide,this.onKeyboardWillHideHandler);C.off("updated",this.load)}async load(){const t=await I.getMain(H.getCurrentDayCode());const e=BX.prop.getObject(t,"currentShift",{});const s={loading:false,enabledBySettings:C.isEnabledBySettings(),shift:new w(e),userInfo:BX.prop.getObject(t,"userInfo",{}),options:BX.prop.getObject(t,"options",{}),diskFolderId:BX.prop.getNumber(t,"diskFolderId",null),counter:BX.prop.getObject(t,"counter",{}),departmentHeadId:BX.prop.getNumber(t,"departmentHeadId",0),isGeoByDefaultZone:BX.prop.getBoolean(t,"isGeoByDefaultZone",true)};this.heightManager.setStatus(s.shift.getStatus());this.heightManager.setEnabledBySettings(s.enabledBySettings);this.heightManager.updateSheetHeight();if(n.isNil(this.dialogInfo.dialogName)&&n.isNil(this.dialogInfo.dialogId)){s.dialogInfo=BX.prop.getObject(t,"dialogInfo",{})}this.setState(s,(()=>this.handleFirstHelpView()))}onKeyboardWillShowHandler(){this.refs.continueButton?.show()}onKeyboardWillHideHandler(){this.refs.continueButton?.hide()}render(){return View({style:{flex:1},resizableByKeyboard:true,onClick:()=>Keyboard.dismiss()},this.renderContent(),this.renderContinueButton())}renderContent(){return u({backgroundColor:o.bgSecondary,style:{flex:1}},this.state.loading&&p(),!this.state.loading&&this.renderHeader(),this.renderCheckIn(),this.renderSettings())}renderCheckIn(){if(!this.state.loading&&this.state.enabledBySettings){return new y({...this.state,layoutWidget:this.layoutWidget,heightManager:this.heightManager,ref:t=>{this.refs.checkIn=t}})}return null}renderSettings(){if(!this.state.loading&&!this.state.enabledBySettings){return new b({isAdmin:this.user.isAdmin,onHelpClick:this.openHelp,onAdminChatButtonClick:this.closeLayoutWidget,departmentHeadId:this.state.departmentHeadId,userInfo:this.state.userInfo,ref:t=>{this.refs.settings=t}})}return null}renderHeader(){return l({isFirst:true,style:{flexDirection:"row",justifyContent:"space-between"}},r({text:i.getMessage("M_STAFFTRACK_CHECK_IN_TITLE")}),this.state.enabledBySettings&&View({style:{flexDirection:"row"}},this.renderStatisticsChip(),this.renderMoreMenuIcon()))}renderStatisticsChip(){return View({ref:t=>{this.refs.statisticsMenu=t}},c({testId:"stafftrack-check-in-statistics",design:g.GREY,mode:f.OUTLINE,dropdown:true,compact:true,color:o.base3,text:i.getMessage("M_STAFFTRACK_CHECK_IN_STATISTICS"),onClick:this.showStatisticsMenu}))}renderMoreMenuIcon(){return View({style:{marginLeft:a.S.toNumber()},ref:t=>{this.refs.moreMenu=t}},h({size:24,icon:d.MORE,color:o.base4,onClick:this.showMoreMenu}))}renderContinueButton(){return new S({ref:t=>{this.refs.continueButton=t}})}showStatisticsMenu(){this.statisticsMenu??=new m({layoutWidget:this.layoutWidget,user:this.user});this.statisticsMenu.show(this.refs.statisticsMenu)}showMoreMenu(){this.moreMenu??=new k({layoutWidget:this.layoutWidget,isMuted:this.isCounterMuted(),onHelpClick:this.openHelp,isAdmin:this.user.isAdmin,hasShift:this.hasCurrentShift()});this.moreMenu.show(this.refs.moreMenu)}handleFirstHelpView(){if(this.options?.isFirstHelpViewed===false){this.openHelp();A.handleFirstHelpView()}}hasCurrentShift(){return n.isNumber(this.shift.id)&&this.shift.id!==0}openHelp(){helpdesk.openHelpArticle("20922794");W.sendHelpdeskOpen(this.props.dialogId?E.CHAT:E.AVA_MENU)}closeLayoutWidget(){this.layoutWidget.close()}}s.exports={CheckIn:T}}));
//# sourceMappingURL=extension.map.js